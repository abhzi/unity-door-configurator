import{c as D,d as G,e as L,W as S,f as M,A as x,g as $,D as v,h as P,i as H,j as c,k as g,a as B,l as b,G as y,B as I,V as O,m as f,n as C}from"./three-DcEme_sN.js";import{O as W}from"./vendor-SrSQa2sQ.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();const w={traditional:{id:"traditional",name:"Traditional Doors",description:"Classic timber door styles",doors:{sixPanel:{id:"six-panel",name:"6 Panel Traditional",description:"Classic six panel timber door",image:"door-images/six-panel.jpg",basePrice:299,allowsGlass:!1,doorType:"panel",defaultConfig:{width:838,height:1981,thickness:44,material:"oak",finish:"natural",hardware:"brass-traditional",hingeType:"butt",lockType:"mortice"},availableOptions:{sizes:[{width:762,height:1981,name:'30"'},{width:838,height:1981,name:'33"'},{width:914,height:1981,name:'36"'}],materials:["oak","pine","mahogany"],finishes:["natural","stained","painted"],hardware:["brass-traditional","chrome-traditional","black-traditional"],hinges:["butt","ball-bearing"],locks:["mortice","cylinder"]}},fourPanel:{id:"four-panel",name:"4 Panel Traditional",description:"Four panel timber door with glass option",image:"door-images/four-panel.jpg",basePrice:329,allowsGlass:!0,doorType:"panel",glassOptions:{types:["clear","frosted","decorative"],maxWidth:400,maxHeight:600,minEdgeDistance:120},defaultConfig:{width:838,height:1981,thickness:44,material:"oak",finish:"natural",hardware:"brass-traditional",hasGlass:!1,glassType:"clear"},availableOptions:{sizes:[{width:762,height:1981,name:'30"'},{width:838,height:1981,name:'33"'},{width:914,height:1981,name:'36"'}],materials:["oak","pine","mahogany"],finishes:["natural","stained","painted"],hardware:["brass-traditional","chrome-traditional"],glassTypes:["clear","frosted","georgian-bars","decorative"]}},glazedTraditional:{id:"glazed-traditional",name:"Traditional Glazed",description:"Traditional door with large glass panel",image:"door-images/glazed-traditional.jpg",basePrice:359,allowsGlass:!0,doorType:"glazed",glassOptions:{types:["clear","frosted","decorative","georgian-bars"],maxWidth:500,maxHeight:800,minEdgeDistance:100},defaultConfig:{width:838,height:1981,thickness:44,material:"oak",finish:"natural",hardware:"brass-traditional",hasGlass:!0,glassType:"clear",glassWidth:400,glassHeight:600}}}},contemporary:{id:"contemporary",name:"Contemporary Doors",description:"Modern timber door designs",doors:{verticalSlat:{id:"vertical-slat",name:"Contemporary Vertical",description:"Modern vertical slat design",image:"door-images/vertical-slat.jpg",basePrice:399,allowsGlass:!0,doorType:"contemporary",glassOptions:{types:["clear","frosted"],maxWidth:200,maxHeight:1200,minEdgeDistance:150},defaultConfig:{width:838,height:1981,thickness:44,material:"oak",finish:"natural",hardware:"chrome-modern",hasGlass:!1},availableOptions:{sizes:[{width:762,height:1981,name:'30"'},{width:838,height:1981,name:'33"'},{width:914,height:1981,name:'36"'}],materials:["oak","walnut"],finishes:["natural","stained","painted"],hardware:["chrome-modern","black-modern","brass-modern"]}},flush:{id:"flush",name:"Contemporary Flush",description:"Clean modern flush door",image:"door-images/flush.jpg",basePrice:279,allowsGlass:!1,doorType:"flush",defaultConfig:{width:838,height:1981,thickness:40,material:"oak",finish:"painted",hardware:"chrome-modern"}}}},rustic:{id:"rustic",name:"Rustic Doors",description:"Traditional farmhouse style doors",doors:{plankedDoor:{id:"planked",name:"Rustic Planked",description:"Traditional planked farmhouse door",image:"door-images/planked.jpg",basePrice:349,allowsGlass:!1,doorType:"rustic",defaultConfig:{width:838,height:1981,thickness:50,material:"pine",finish:"natural",hardware:"black-rustic"}}}}};class R{constructor(e){this.onDoorSelected=e,this.searchTerm=""}render(){const e=document.getElementById("door-categories");document.getElementById("door-search").addEventListener("input",i=>{this.searchTerm=i.target.value.toLowerCase(),this.filterAndRender()}),this.renderCategories(e),this.attachEventListeners()}renderCategories(e){let t="";Object.entries(w).forEach(([i,s])=>{const a=this.filterDoors(s.doors);Object.keys(a).length!==0&&(t+=`<div class="category-section"><h3>${s.name}</h3><p class="category-description">${s.description}</p><div class="door-grid">`,Object.entries(a).forEach(([r,n])=>{t+=this.renderDoorCard(i,r,n)}),t+="</div></div>")}),e.innerHTML=t}renderDoorCard(e,t,i){return`<div class="door-card" data-category="${e}" data-door="${t}"><div class="door-image"><img src="${i.image||"/door-images/placeholder.png"}" alt="${i.name}" onerror="this.src='/door-images/placeholder.png'"></div><div class="door-info"><h4>${i.name}<svg class="info-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2C13.1,2 14,2.9 14,4C14,5.1 13.1,6 12,6C10.9,6 10,5.1 10,4C10,2.9 10.9,2 12,2M21,9V7L15,1L9,7V9H3V21H21V9H21M12,19C8.7,19 6,16.3 6,13C6,11.4 6.6,10 7.6,8.9L12,13.3L16.4,8.9C17.4,10 18,11.4 18,13C18,16.3 15.3,19 12,19Z"/></svg></h4><p>${i.description}</p>${i.allowsGlass?'<span class="feature-tag">Glass option available</span>':""}<div class="price-info"><span class="price">From £${i.basePrice}</span>${this.getAvailabilityBadge(i)}</div></div></div>`}getAvailabilityBadge(e){return e.availableOptions?.materials?.some(()=>!1)?'<span class="availability-badge special">Special Order</span>':'<span class="availability-badge standard">In Stock</span>'}filterDoors(e){if(!this.searchTerm)return e;const t={};return Object.entries(e).forEach(([i,s])=>{(s.name.toLowerCase().includes(this.searchTerm)||s.description.toLowerCase().includes(this.searchTerm))&&(t[i]=s)}),t}filterAndRender(){const e=document.getElementById("door-categories");this.renderCategories(e),this.attachEventListeners()}attachEventListeners(){const e=document.getElementById("door-categories"),t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",i=>{const s=i.target.closest(".door-card");s&&this.onDoorSelected(s.dataset.category,s.dataset.door)})}}const u={dimensions:{width:{min:610,max:1200,standard:[610,686,762,838,914,990],customSurcharge:50},height:{min:1800,max:2400,standard:[1981,2032,2134],customSurcharge:30},thickness:{standard:[35,40,44,50,54]}},glass:{minEdgeDistance:100,maxWidthPercentage:.7,maxHeightPercentage:.8,requiredThickness:44,additionalCost:75},hardwareCompatibility:{hinges:{butt:{compatibleLocks:["mortice","cylinder"],incompatibleDoorStyles:["ultra-thin"],minThickness:35,maxWeight:45},"ball-bearing":{compatibleLocks:["cylinder","multipoint"],requiredThickness:44,maxWeight:65,additionalCost:25},parliament:{compatibleLocks:["cylinder"],requiredThickness:44,specialOrder:!0,additionalCost:45,leadTime:7}},locks:{mortice:{requiredThickness:44,compatibleHinges:["butt","ball-bearing"],securityRating:"high"},cylinder:{requiredThickness:35,compatibleHinges:["butt","ball-bearing","parliament"],securityRating:"medium"},multipoint:{requiredThickness:50,compatibleHinges:["ball-bearing"],additionalCost:95,securityRating:"maximum"}},handles:{"brass-traditional":{styles:["traditional"],finish:"brass"},"chrome-traditional":{styles:["traditional"],finish:"chrome"},"black-traditional":{styles:["traditional"],finish:"black"},"chrome-modern":{styles:["contemporary"],finish:"chrome"},"black-modern":{styles:["contemporary"],finish:"black"},"brass-modern":{styles:["contemporary"],finish:"brass"},"black-rustic":{styles:["rustic"],finish:"black"}}},materialConstraints:{oak:{additionalCost:50,availability:"standard",finishOptions:["natural","stained","painted"]},pine:{additionalCost:0,availability:"standard",finishOptions:["natural","stained","painted"]},mahogany:{additionalCost:120,availability:"special-order",leadTime:10,finishOptions:["natural","stained"]},walnut:{additionalCost:150,availability:"special-order",leadTime:14,finishOptions:["natural","stained"]}},finishConstraints:{painted:{additionalCost:25,leadTime:5,availableColors:["white","cream","grey","black","blue","green","custom"]},stained:{additionalCost:15,leadTime:3,availableStains:["light-oak","medium-oak","dark-oak","mahogany","walnut","ebony"]},natural:{additionalCost:0,leadTime:0}},businessRules:{standardLeadTime:14,incompatibleCombinations:[{hinge:"parliament",lock:"multipoint",reason:"Mechanical interference"},{thickness:35,lock:"mortice",reason:"Insufficient thickness for mortice lock"},{doorType:"flush",hardware:"brass-traditional",reason:"Style mismatch"}]}};class k{static validate(e,t){const i=[],s=[],a=this.validateDimensions(t);if(i.push(...a),t.hasGlass){const o=this.validateGlass(e,t);i.push(...o)}const r=this.validateHardware(e,t);i.push(...r);const n=this.validateMaterial(t);s.push(...n);const l=this.validateBusinessRules(e,t);return i.push(...l),{isValid:i.length===0,errors:i,warnings:s,estimatedLeadTime:this.calculateLeadTime(t),additionalCosts:this.calculateAdditionalCosts(t)}}static validateDimensions(e){const t=[],i=u.dimensions;return(e.width<i.width.min||e.width>i.width.max)&&t.push(`Width must be between ${i.width.min}mm and ${i.width.max}mm`),(e.height<i.height.min||e.height>i.height.max)&&t.push(`Height must be between ${i.height.min}mm and ${i.height.max}mm`),e.thickness&&!i.thickness.standard.includes(e.thickness)&&t.push(`Available thicknesses: ${i.thickness.standard.join("mm, ")}mm`),t}static validateGlass(e,t){const i=[],s=u.glass;if(!e.allowsGlass)return i.push("This door style does not support glass panels"),i;if(t.thickness<s.requiredThickness&&i.push(`Glass requires minimum ${s.requiredThickness}mm door thickness`),t.glassWidth&&t.glassHeight){const a=t.width*s.maxWidthPercentage,r=t.height*s.maxHeightPercentage;t.glassWidth>a&&i.push(`Glass width cannot exceed ${Math.floor(a)}mm (${Math.floor(s.maxWidthPercentage*100)}% of door width)`),t.glassHeight>r&&i.push(`Glass height cannot exceed ${Math.floor(r)}mm (${Math.floor(s.maxHeightPercentage*100)}% of door height)`);const n=t.glassX||(t.width-t.glassWidth)/2,l=t.glassY||(t.height-t.glassHeight)/2,o=n,m=t.width-(n+t.glassWidth),d=l,p=t.height-(l+t.glassHeight);(o<s.minEdgeDistance||m<s.minEdgeDistance||d<s.minEdgeDistance||p<s.minEdgeDistance)&&i.push(`Glass must be at least ${s.minEdgeDistance}mm from all edges`)}return e.glassOptions&&(t.glassWidth>e.glassOptions.maxWidth&&i.push(`Maximum glass width for this door style: ${e.glassOptions.maxWidth}mm`),t.glassHeight>e.glassOptions.maxHeight&&i.push(`Maximum glass height for this door style: ${e.glassOptions.maxHeight}mm`)),i}static validateHardware(e,t){const i=[],s=u.hardwareCompatibility;if(t.hingeType&&s.hinges[t.hingeType]){const r=s.hinges[t.hingeType];r.requiredThickness&&t.thickness<r.requiredThickness&&i.push(`${t.hingeType} hinges require minimum ${r.requiredThickness}mm thickness`),t.lockType&&!r.compatibleLocks.includes(t.lockType)&&i.push(`${t.hingeType} hinges are not compatible with ${t.lockType} locks`)}if(t.lockType&&s.locks[t.lockType]){const r=s.locks[t.lockType];r.requiredThickness&&t.thickness<r.requiredThickness&&i.push(`${t.lockType} locks require minimum ${r.requiredThickness}mm thickness`)}if(t.hardware&&s.handles[t.hardware]){const r=s.handles[t.hardware];r.styles&&!r.styles.includes(e.doorType)&&i.push(`${t.hardware} handles are not suitable for ${e.doorType} doors`)}const a=u.businessRules.incompatibleCombinations.find(r=>Object.entries(r).every(([n,l])=>n==="reason"?!0:t[n]===l));return a&&i.push(a.reason||"This combination is not available"),i}static validateMaterial(e){const t=[],i=u.materialConstraints;if(e.material&&i[e.material]){const s=i[e.material];s.availability==="special-order"&&t.push(`${e.material} is a special order item (${s.leadTime} additional days)`)}return t}static validateBusinessRules(e,t){return[]}static calculateLeadTime(e){let t=u.businessRules.standardLeadTime;const i=u.materialConstraints[e.material];i&&i.leadTime&&(t+=i.leadTime);const s=u.finishConstraints[e.finish];if(s&&s.leadTime&&(t+=s.leadTime),e.hingeType){const a=u.hardwareCompatibility.hinges[e.hingeType];a&&a.leadTime&&(t+=a.leadTime)}return t}static calculateAdditionalCosts(e){let t=0;const i=u.materialConstraints[e.material];i&&(t+=i.additionalCost||0);const s=u.finishConstraints[e.finish];if(s&&(t+=s.additionalCost||0),e.hasGlass&&(t+=u.glass.additionalCost),e.hingeType){const r=u.hardwareCompatibility.hinges[e.hingeType];r&&r.additionalCost&&(t+=r.additionalCost)}if(e.lockType){const r=u.hardwareCompatibility.locks[e.lockType];r&&r.additionalCost&&(t+=r.additionalCost)}const a=u.dimensions;return a.width.standard.includes(e.width)||(t+=a.width.customSurcharge),a.height.standard.includes(e.height)||(t+=a.height.customSurcharge),t}}class A{constructor(e,t){this.onConfigChanged=e,this.viewer=t,this.currentDoor=null,this.currentConfig={}}loadDoor(e,t){this.currentDoor=e,this.currentConfig={...t},this.updateHeader(),this.renderConfigPanels(),this.viewer&&this.viewer.createDoor(this.currentConfig)}updateHeader(){document.getElementById("selected-door-name").textContent=this.currentDoor.name,document.getElementById("selected-door-description").textContent="Resizable "+this.currentDoor.description}renderConfigPanels(){const e=document.getElementById("config-panels");let t=this.renderDimensionsPanel();t+=this.renderMaterialPanel(),t+=this.renderHardwarePanel(),this.currentDoor.allowsGlass&&(t+=this.renderGlassPanel()),e.innerHTML=t,this.attachEventListeners(),this.updatePrice()}renderDimensionsPanel(){const e=this.currentDoor.availableOptions?.sizes||[];return`<div class="config-section"><h4>Dimensions</h4>${e.length>0?`<div class="input-group"><label>Standard Sizes</label><div class="option-grid">${e.map(t=>`<button class="option-btn size-option ${t.width===this.currentConfig.width?"active":""}" data-width="${t.width}" data-height="${t.height}">${t.name}<br><small>${t.width} × ${t.height}mm</small></button>`).join("")}</div></div>`:""}
      <div class="input-group"><label>Width (mm)</label><div class="dual-input"><input type="number" id="door-width" value="${this.currentConfig.width}" min="610" max="1200" step="1"><input type="range" id="door-width-slider" value="${this.currentConfig.width}" min="610" max="1200" step="1"></div></div><div class="input-group"><label>Height (mm)</label><div class="dual-input"><input type="number" id="door-height" value="${this.currentConfig.height}" min="1800" max="2400" step="1"><input type="range" id="door-height-slider" value="${this.currentConfig.height}" min="1800" max="2400" step="1"></div></div><div class="input-group"><label>Thickness (mm)</label><select id="door-thickness"><option value="35" ${this.currentConfig.thickness===35?"selected":""}>35mm - Standard</option><option value="40" ${this.currentConfig.thickness===40?"selected":""}>40mm</option><option value="44" ${this.currentConfig.thickness===44?"selected":""}>44mm - Premium</option><option value="50" ${this.currentConfig.thickness===50?"selected":""}>50mm - Heavy Duty</option><option value="54" ${this.currentConfig.thickness===54?"selected":""}>54mm - Fire Rated</option></select></div></div>`}renderMaterialPanel(){const e=this.currentDoor.availableOptions?.materials||["oak","pine"],t=this.currentDoor.availableOptions?.finishes||["natural","stained","painted"];return`<div class="config-section"><h4>Material & Finish</h4><div class="input-group"><label>Wood Type</label><select id="door-material">${e.map(i=>`<option value="${i}" ${i===this.currentConfig.material?"selected":""}>${this.formatMaterialName(i)}</option>`).join("")}</select></div><div class="input-group"><label>Finish</label><div class="option-grid">${t.map(i=>`<button class="option-btn finish-option ${i===this.currentConfig.finish?"active":""}" data-finish="${i}">${this.formatFinishName(i)}</button>`).join("")}</div></div>${this.currentConfig.finish==="painted"?'<div class="input-group"><label>Paint Color</label><select id="paint-color"><option value="white">White</option><option value="cream">Cream</option><option value="grey">Grey</option><option value="black">Black</option><option value="custom">Custom RAL Color</option></select></div>':""}
      ${this.currentConfig.finish==="stained"?'<div class="input-group"><label>Stain Color</label><select id="stain-color"><option value="light-oak">Light Oak</option><option value="medium-oak">Medium Oak</option><option value="dark-oak">Dark Oak</option><option value="mahogany">Mahogany</option><option value="walnut">Walnut</option></select></div>':""}</div>`}renderHardwarePanel(){return`<div class="config-section"><h4>Hardware</h4><div class="input-group"><label>Handle Style</label><div class="option-grid">${(this.currentDoor.availableOptions?.hardware||["brass-traditional"]).map(t=>`<button class="option-btn hardware-option ${t===this.currentConfig.hardware?"active":""}" data-hardware="${t}">${this.formatHardwareName(t)}</button>`).join("")}</div></div><div class="input-group"><label>Hinge Type</label><select id="hinge-type"><option value="butt" ${this.currentConfig.hingeType==="butt"?"selected":""}>Butt Hinge - Standard</option><option value="ball-bearing" ${this.currentConfig.hingeType==="ball-bearing"?"selected":""}>Ball Bearing - Premium (+£25)</option><option value="parliament" ${this.currentConfig.hingeType==="parliament"?"selected":""}>Parliament - Special Order (+£45)</option></select></div><div class="input-group"><label>Lock Type</label><select id="lock-type"><option value="mortice" ${this.currentConfig.lockType==="mortice"?"selected":""}>Mortice Lock - High Security</option><option value="cylinder" ${this.currentConfig.lockType==="cylinder"?"selected":""}>Cylinder Lock - Standard</option><option value="multipoint" ${this.currentConfig.lockType==="multipoint"?"selected":""}>Multi-point - Maximum Security (+£95)</option></select></div></div>`}renderGlassPanel(){const e=this.currentDoor.availableOptions?.glassTypes||["clear","frosted"],t=Math.min(400,Math.floor(this.currentConfig.width*.6)),i=Math.min(600,Math.floor(this.currentConfig.height*.6)),s=this.currentConfig.glassWidth||t,a=this.currentConfig.glassHeight||i;return`<div class="config-section"><h4>Glass Panel</h4><div class="checkbox-group"><input type="checkbox" id="has-glass" ${this.currentConfig.hasGlass?"checked":""}><label for="has-glass">Add Glass Panel (+£75)</label></div><div id="glass-options" class="glass-options" style="${this.currentConfig.hasGlass?"":"display:none"}"><div class="input-group"><label>Glass Type</label><div class="option-grid">${e.map(r=>`<button class="option-btn glass-type-option ${r===(this.currentConfig.glassType||"clear")?"active":""}" data-glass-type="${r}">${this.formatGlassTypeName(r)}</button>`).join("")}</div></div><div class="input-group"><label>Glass Width (mm)</label><div class="dual-input"><input type="number" id="glass-width" value="${s}" min="200" max="${Math.floor(this.currentConfig.width*.7)}" step="1"><input type="range" id="glass-width-slider" value="${s}" min="200" max="${Math.floor(this.currentConfig.width*.7)}" step="1"></div></div><div class="input-group"><label>Glass Height (mm)</label><div class="dual-input"><input type="number" id="glass-height" value="${a}" min="300" max="${Math.floor(this.currentConfig.height*.8)}" step="1"><input type="range" id="glass-height-slider" value="${a}" min="300" max="${Math.floor(this.currentConfig.height*.8)}" step="1"></div></div></div></div>`}attachEventListeners(){document.querySelectorAll(".size-option").forEach(a=>{a.addEventListener("click",r=>{const n=parseInt(r.target.dataset.width),l=parseInt(r.target.dataset.height);this.updateConfig({width:n,height:l}),this.updateSizeInputs()})}),[{input:"door-width",slider:"door-width-slider",prop:"width"},{input:"door-height",slider:"door-height-slider",prop:"height"}].forEach(a=>{const r=document.getElementById(a.input),n=document.getElementById(a.slider);r&&n&&(r.addEventListener("change",l=>{const o=parseInt(l.target.value);n.value=o,this.updateConfig({[a.prop]:o}),this.updateGlassLimits()}),n.addEventListener("input",l=>{const o=parseInt(l.target.value);r.value=o,this.updateConfig({[a.prop]:o}),this.updateGlassLimits()}))});const t=document.getElementById("door-thickness");t&&t.addEventListener("change",a=>this.updateConfig({thickness:parseInt(a.target.value)})),["door-material","hinge-type","lock-type"].forEach(a=>{const r=document.getElementById(a);r&&r.addEventListener("change",()=>this.handleConfigChange())}),document.querySelectorAll(".finish-option").forEach(a=>{a.addEventListener("click",r=>{this.updateConfig({finish:r.target.dataset.finish}),this.rerenderPanels()})}),document.querySelectorAll(".hardware-option").forEach(a=>{a.addEventListener("click",r=>{this.updateConfig({hardware:r.target.dataset.hardware})})});const i=document.getElementById("has-glass");i&&i.addEventListener("change",a=>{const r=a.target.checked;document.getElementById("glass-options").style.display=r?"block":"none",r&&(this.currentConfig.glassWidth||(this.currentConfig.glassWidth=Math.min(400,Math.floor(this.currentConfig.width*.6))),this.currentConfig.glassHeight||(this.currentConfig.glassHeight=Math.min(600,Math.floor(this.currentConfig.height*.6))),this.currentConfig.glassType||(this.currentConfig.glassType="clear"),this.syncGlassInputs(),this.updateGlassLimits()),this.updateConfig({hasGlass:r,glassWidth:r?this.currentConfig.glassWidth:void 0,glassHeight:r?this.currentConfig.glassHeight:void 0,glassType:r?this.currentConfig.glassType:void 0})}),[{input:"glass-width",slider:"glass-width-slider",prop:"glassWidth"},{input:"glass-height",slider:"glass-height-slider",prop:"glassHeight"}].forEach(a=>{const r=document.getElementById(a.input),n=document.getElementById(a.slider);r&&n&&(r.addEventListener("change",l=>{const o=parseInt(l.target.value);n.value=o,this.updateConfig({[a.prop]:o})}),n.addEventListener("input",l=>{const o=parseInt(l.target.value);r.value=o,this.updateConfig({[a.prop]:o})}))}),document.querySelectorAll(".glass-type-option").forEach(a=>{a.addEventListener("click",r=>{this.updateConfig({glassType:r.target.dataset.glassType})})})}handleConfigChange(){const e={material:document.getElementById("door-material")?.value||this.currentConfig.material,hingeType:document.getElementById("hinge-type")?.value||this.currentConfig.hingeType,lockType:document.getElementById("lock-type")?.value||this.currentConfig.lockType};this.updateConfig(e)}handleGlassChange(){if(!this.currentConfig.hasGlass)return;const e=parseInt(document.getElementById("glass-width")?.value)||this.currentConfig.glassWidth,t=parseInt(document.getElementById("glass-height")?.value)||this.currentConfig.glassHeight;this.updateConfig({glassWidth:e,glassHeight:t}),this.syncGlassInputs()}updateConfig(e){e.hasGlass===!0&&!e.glassWidth&&!this.currentConfig.glassWidth&&(e.glassWidth=Math.min(400,Math.floor(this.currentConfig.width*.6)),e.glassHeight=Math.min(600,Math.floor(this.currentConfig.height*.6)),e.glassType=e.glassType||this.currentConfig.glassType||"clear"),this.currentConfig={...this.currentConfig,...e},this.onConfigChanged(this.currentConfig),this.updatePrice(),this.updateActiveStates()}updateSizeInputs(){this.syncInputs("door-width","door-width-slider",this.currentConfig.width),this.syncInputs("door-height","door-height-slider",this.currentConfig.height)}syncInputs(e,t,i){const s=document.getElementById(e),a=document.getElementById(t);s&&(s.value=i),a&&(a.value=i)}syncGlassInputs(){this.syncInputs("glass-width","glass-width-slider",this.currentConfig.glassWidth),this.syncInputs("glass-height","glass-height-slider",this.currentConfig.glassHeight)}updateGlassLimits(){const e=Math.floor(this.currentConfig.width*.7),t=Math.floor(this.currentConfig.height*.8);["glass-width","glass-width-slider"].forEach(i=>{const s=document.getElementById(i);s&&(s.max=e)}),["glass-height","glass-height-slider"].forEach(i=>{const s=document.getElementById(i);s&&(s.max=t)})}updateActiveStates(){document.querySelectorAll(".size-option").forEach(e=>{e.classList.toggle("active",parseInt(e.dataset.width)===this.currentConfig.width&&parseInt(e.dataset.height)===this.currentConfig.height)}),document.querySelectorAll(".finish-option").forEach(e=>{e.classList.toggle("active",e.dataset.finish===this.currentConfig.finish)}),document.querySelectorAll(".hardware-option").forEach(e=>{e.classList.toggle("active",e.dataset.hardware===this.currentConfig.hardware)}),document.querySelectorAll(".glass-type-option").forEach(e=>{e.classList.toggle("active",e.dataset.glassType===this.currentConfig.glassType)})}rerenderPanels(){this.renderConfigPanels()}updatePrice(){const e=k.validate(this.currentDoor,this.currentConfig),t=(this.currentDoor.basePrice||299)+(e.additionalCosts||0),i=document.getElementById("price-display");i&&(i.textContent=t)}formatMaterialName(e){return{oak:"Oak Wood",pine:"Pine Wood",mahogany:"Mahogany (+£120)",walnut:"Walnut (+£150)"}[e]||e.charAt(0).toUpperCase()+e.slice(1)}formatFinishName(e){return{natural:"Natural",stained:"Stained (+£15)",painted:"Painted (+£25)"}[e]||e.charAt(0).toUpperCase()+e.slice(1)}formatHardwareName(e){return{"brass-traditional":"Traditional Brass","chrome-traditional":"Traditional Chrome","black-traditional":"Traditional Black","chrome-modern":"Modern Chrome","black-modern":"Modern Black","brass-modern":"Modern Brass","black-rustic":"Rustic Black"}[e]||e}formatGlassTypeName(e){return{clear:"Clear Glass",frosted:"Frosted Glass",decorative:"Decorative Glass","georgian-bars":"Georgian Bars"}[e]||e}}class F{constructor(e){this.canvas=document.getElementById(e),this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.doorGroup=null,this.materials={},this.init(),this.setupMaterials()}init(){this.scene=new D,this.scene.background=new G(16316922),this.camera=new L(85,this.canvas.parentElement.clientWidth/this.canvas.parentElement.clientHeight,.01,5e3),this.camera.position.set(600,500,2500),this.renderer=new S({canvas:this.canvas,antialias:!0,alpha:!0}),this.updateRendererSize=()=>{const e=this.canvas.parentElement,t=e.clientWidth,i=e.clientHeight;this.renderer.setSize(t,i,!1),this.camera.aspect=t/i,this.camera.updateProjectionMatrix(),this.renderer.render(this.scene,this.camera)},this.updateRendererSize(),window.addEventListener("resize",()=>{this.updateRendererSize()}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=M,this.renderer.outputEncoding=void 0,this.renderer.toneMapping=x,this.renderer.toneMappingExposure=1,this.controls=new W(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.screenSpacePanning=!1,this.controls.minDistance=300,this.controls.maxDistance=1500,this.controls.maxPolarAngle=Math.PI/2,this.setupLighting(),this.animate()}setupLighting(){const e=new $(16777215,.6);this.scene.add(e);const t=new v(16777215,1);t.position.set(200,200,100),t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.camera.near=.1,t.shadow.camera.far=500,t.shadow.camera.left=-200,t.shadow.camera.right=200,t.shadow.camera.top=200,t.shadow.camera.bottom=-200,this.scene.add(t);const i=new v(16777215,.4);i.position.set(-100,50,50),this.scene.add(i);const s=new v(16777215,.3);s.position.set(0,100,-200),this.scene.add(s)}addGroundPlane(){const e=new P(2e3,2e3),t=new H({color:15790320,transparent:!0,opacity:.8}),i=new c(e,t);i.rotation.x=-Math.PI/2,i.position.y=-50,i.receiveShadow=!0,this.scene.add(i)}setupMaterials(){this.materials.wood={oak:new g({color:9136404,roughness:.8,metalness:.05,normalScale:new B(.5,.5)}),pine:new g({color:14596231,roughness:.7,metalness:.05}),mahogany:new g({color:8145466,roughness:.6,metalness:.1}),walnut:new g({color:6111287,roughness:.7,metalness:.1})},this.materials.painted={white:new g({color:16316671,roughness:.4,metalness:.05}),cream:new g({color:16776656,roughness:.4,metalness:.05}),grey:new g({color:8421504,roughness:.4,metalness:.05}),black:new g({color:2894892,roughness:.3,metalness:.1})},this.materials.glass={clear:new b({color:16777215,transparent:!0,opacity:.05,roughness:0,metalness:0,transmission:.95,thickness:2,ior:1.5,reflectivity:.1}),frosted:new b({color:16777215,transparent:!0,opacity:.3,roughness:1,metalness:0,transmission:.7,thickness:2}),decorative:new b({color:15267064,transparent:!0,opacity:.2,roughness:.8,metalness:0,transmission:.8,thickness:2})},this.materials.hardware={brass:new g({color:12092939,roughness:.2,metalness:.9}),chrome:new g({color:12632256,roughness:.1,metalness:.95}),black:new g({color:2894892,roughness:.3,metalness:.8})},this.materials.frame=new g({color:9139029,roughness:.8,metalness:.05})}createDoor(e){this.doorGroup&&this.scene.remove(this.doorGroup),this.doorGroup=new y;const t=this.createDoorPanel(e),i=this.createDoorFrame(e);if(this.doorGroup.add(t),this.doorGroup.add(i),e.hasGlass&&e.glassWidth&&e.glassHeight&&e.glassWidth>0&&e.glassHeight>0){console.log("Creating glass panel:",{width:e.glassWidth,height:e.glassHeight,type:e.glassType});const n=this.createGlassPanel(e);this.doorGroup.add(n)}const s=this.createHardware(e);this.doorGroup.add(s),this.addDoorStyleDetails(e);const r=new I().setFromObject(this.doorGroup).getCenter(new O);this.doorGroup.position.sub(r),this.doorGroup.position.y=0,this.scene.add(this.doorGroup),requestAnimationFrame(()=>{this.updateRendererSize()})}createDoorPanel(e){const t=e.width||838,i=e.height||1981,s=e.thickness||44,a=new f(t,i,s),r=this.getDoorMaterial(e),n=new c(a,r);return n.castShadow=!0,n.receiveShadow=!0,n}createDoorFrame(e){const t=new y,i=60,s=30,a=e.width||838,r=e.height||1981,n=new f(i,r+i*2,s),l=new c(n,this.materials.frame);l.position.set(-a/2-i/2,i/2,-s/2),l.castShadow=!0,t.add(l);const o=new c(n,this.materials.frame);o.position.set(a/2+i/2,i/2,-s/2),o.castShadow=!0,t.add(o);const m=new f(a+i*2,i,s),d=new c(m,this.materials.frame);d.position.set(0,r/2+i/2,-s/2),d.castShadow=!0,t.add(d);const p=new c(m,this.materials.frame);return p.position.set(0,-r/2-i/2,-s/2),p.castShadow=!0,t.add(p),t}createGlassPanel(e){const t=e.glassWidth,i=e.glassHeight,s=6,a=e.glassX||0,r=e.glassY||0,n=new f(t,i,s),l=this.getGlassMaterial(e.glassType||"clear"),o=new c(n,l);o.position.set(a,r,e.thickness/2+s/2+1),o.castShadow=!0,o.receiveShadow=!0;const m=this.createGlassFrame(t,i,e);m.position.copy(o.position);const d=new y;return d.add(o),d.add(m),d}createGlassFrame(e,t,i){const s=new y,a=8,r=6,n=this.getDoorMaterial(i),l=new f(e+a*2,a,r),o=new c(l,n);o.position.set(0,t/2+a/2,r/2),s.add(o);const m=new c(l,n);m.position.set(0,-t/2-a/2,r/2),s.add(m);const d=new f(a,t,r),p=new c(d,n);p.position.set(-e/2-a/2,0,r/2),s.add(p);const T=new c(d,n);return T.position.set(e/2+a/2,0,r/2),s.add(T),s}createHardware(e){const t=new y,i=e.width||838,s=e.thickness||44,a=this.getHardwareMaterial(e.hardware),r=new C(6,6,120,8),n=new c(r,a);n.rotation.z=Math.PI/2,n.position.set(i/2-100,0,s/2+20),n.castShadow=!0,t.add(n);const l=new C(25,25,8,16),o=new c(l,a);o.rotation.x=Math.PI/2,o.position.set(i/2-100,0,s/2+4),o.castShadow=!0,t.add(o);const m=new C(3,3,8,8),d=new c(m,this.materials.hardware.black);return d.rotation.x=Math.PI/2,d.position.set(i/2-100,-15,s/2+8),t.add(d),this.createHinges(t,e),t}createHinges(e,t){const i=t.width||838,s=t.height||1981;t.thickness;const a=this.getHardwareMaterial(t.hardware);[s/2-150,0,-s/2+150].forEach(n=>{const l=new f(8,80,60),o=new c(l,a);o.position.set(-i/2-4,n,0),o.castShadow=!0,e.add(o);const m=new C(4,4,80,8),d=new c(m,a);d.position.set(-i/2-8,n,0),d.castShadow=!0,e.add(d)})}addDoorStyleDetails(e){}getDoorMaterial(e){if(e.finish==="painted"){const t=e.paintColor||"white";return this.materials.painted[t]||this.materials.painted.white}else{const t=e.material||"oak";return this.materials.wood[t]||this.materials.wood.oak}}getGlassMaterial(e){return this.materials.glass[e]||this.materials.glass.clear}getHardwareMaterial(e){return e&&e.includes("brass")?this.materials.hardware.brass:e&&e.includes("black")?this.materials.hardware.black:this.materials.hardware.chrome}animate(){requestAnimationFrame(()=>this.animate()),this.controls.update(),this.renderer.render(this.scene,this.camera)}onWindowResize(){this.updateRendererSize()}resetView(){this.camera.position.set(600,500,2500),this.controls.target.set(0,0,0),this.controls.update()}}class q{constructor(){this.currentDoor=null,this.currentConfig={},this.viewer=null,this.productSelector=new R(this.onDoorSelected.bind(this)),this.configurator=null,this.init()}init(){this.productSelector.render(),this.setupEventListeners(),this.setupHistoryManagement(),this.viewer=new F("three-canvas"),console.log("Unity Door Configurator initialized"),console.log("Available door catalog:",w)}setupHistoryManagement(){window.addEventListener("popstate",e=>{e.state?e.state.page==="configurator"&&e.state.doorData?(this.currentDoor=w[e.state.doorData.doorType].doors[e.state.doorData.doorId],this.currentConfig={...this.currentDoor.defaultConfig},this.showConfigurator(e.state.doorData.doorType,e.state.doorData.doorId,!1)):e.state.page==="selector"&&this.showProductSelector(!1):this.showProductSelector(!1)}),window.history.replaceState({page:"selector"},"Unity Doors - Door Selector",window.location.pathname)}onDoorSelected(e,t){this.currentDoor=w[e].doors[t],this.currentConfig={...this.currentDoor.defaultConfig},console.log("Door selected:",this.currentDoor.name),console.log("Default config:",this.currentConfig),window.history.pushState({page:"configurator",doorData:{doorType:e,doorId:t}},`Unity Doors - ${this.currentDoor.name}`,`#configurator/${e}/${t}`),this.showConfigurator(e,t,!0)}showConfigurator(e,t,i=!0){this.showLoadingState(!0),this.configurator||(this.configurator=new A(this.onConfigChanged.bind(this),this.viewer)),document.getElementById("product-selector").classList.add("hidden"),document.getElementById("configurator").classList.remove("hidden"),this.configurator.loadDoor(this.currentDoor,this.currentConfig),setTimeout(()=>{this.viewer.createDoor(this.currentConfig),this.showLoadingState(!1)},100)}showProductSelector(e=!0){document.getElementById("configurator").classList.add("hidden"),document.getElementById("product-selector").classList.remove("hidden"),e&&window.history.pushState({page:"selector"},"Unity Doors - Door Selector",window.location.pathname),console.log("Returned to product selector")}showLoadingState(e){const t=document.getElementById("loading-overlay");t&&(e?t.classList.remove("hidden"):t.classList.add("hidden"))}onConfigChanged(e){const t={...this.currentConfig};this.currentConfig={...this.currentConfig,...e},console.log("Configuration changed:",{from:t,to:this.currentConfig,changes:e});const i=k.validate(this.currentDoor,this.currentConfig);this.displayValidationResults(i),this.viewer.createDoor(this.currentConfig),i.errors.length>0&&console.warn("Configuration errors:",i.errors),i.warnings.length>0&&console.info("Configuration warnings:",i.warnings)}displayValidationResults(e){const t=document.getElementById("validation-errors");e.errors.length>0?(t.innerHTML=e.errors.map(i=>`<div class="error">${i}</div>`).join(""),t.classList.remove("hidden")):t.classList.add("hidden"),e.warnings.length>0&&console.info("Configuration warnings:",e.warnings)}setupEventListeners(){document.getElementById("back-btn").addEventListener("click",()=>{this.showProductSelector(!0)}),document.getElementById("export-config").addEventListener("click",()=>{this.exportConfiguration()}),document.getElementById("reset-view").addEventListener("click",()=>{this.viewer&&this.viewer.resetView()});const e=document.getElementById("close-selector");e&&e.addEventListener("click",()=>{console.log("Close configurator"),confirm("Are you sure you want to leave the configurator?")&&window.open("https://unitydoors.com","_self")}),window.addEventListener("resize",()=>{this.viewer&&this.viewer.onWindowResize()})}exportConfiguration(){const e=k.validate(this.currentDoor,this.currentConfig);if(e.errors.length>0){alert(`Please resolve configuration errors before exporting:

`+e.errors.join(`
`));return}const t={door:{id:this.currentDoor.id,name:this.currentDoor.name,category:this.findDoorCategory(this.currentDoor.id),type:this.currentDoor.doorType},configuration:{...this.currentConfig,timestamp:new Date().toISOString()},pricing:{basePrice:this.currentDoor.basePrice,additionalCosts:e.additionalCosts||0,totalPrice:this.currentDoor.basePrice+(e.additionalCosts||0),currency:"GBP"},manufacturing:{estimatedLeadTime:e.estimatedLeadTime||14,specialOrder:this.isSpecialOrder(),certifications:this.getRequiredCertifications()},specifications:{dimensions:{width:this.currentConfig.width,height:this.currentConfig.height,thickness:this.currentConfig.thickness},materials:{wood:this.currentConfig.material,finish:this.currentConfig.finish,glass:this.currentConfig.hasGlass?this.currentConfig.glassType:null},hardware:{handle:this.currentConfig.hardware,hinges:this.currentConfig.hingeType,lock:this.currentConfig.lockType}},customer:{name:"",email:"",phone:"",address:""},export:{version:"1.0",generatedBy:"Unity Door Configurator",timestamp:new Date().toISOString()}},i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(i),a=document.createElement("a");a.href=s,a.download=`unity-door-quote-${Date.now()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),console.log("Configuration exported:",t),alert(`Quote generated successfully!

Door: ${this.currentDoor.name}
Size: ${this.currentConfig.width} × ${this.currentConfig.height}mm
Estimated Price: £${t.pricing.totalPrice}
Lead Time: ${e.estimatedLeadTime||14} days

Quote file downloaded. Please send this to Unity Doors for processing.`)}findDoorCategory(e){for(const[t,i]of Object.entries(w))if(i.doors[e])return t;return"unknown"}isSpecialOrder(){const e=["mahogany","walnut"],t=this.currentConfig.hingeType==="parliament";return e.includes(this.currentConfig.material)||t}getRequiredCertifications(){const e=[];return this.currentConfig.thickness>=54&&e.push("Fire Rated"),this.currentConfig.hasGlass&&e.push("Safety Glass Compliant"),e}}window.showAbout=function(){const h=E("About Unity Doors",`
        <div class="modal-content">
            <h3>Unity Doors - Premium Door Solutions</h3>
            <p>We specialize in bespoke timber doors, combining traditional craftsmanship with modern design. Our configurator allows you to design your perfect door with real-time 3D visualization.</p>
            <ul>
                <li>Premium quality timber construction</li>
                <li>Bespoke sizing and customization</li>
                <li>Professional installation service</li>
                <li>10-year manufacturing warranty</li>
            </ul>
            <p><strong>Est. 1985</strong> - Over 35 years of door craftsmanship excellence</p>
        </div>
    `);document.body.appendChild(h)};window.showContact=function(){const h=E("Contact Unity Doors",`
        <div class="modal-content">
            <h3>Get in Touch</h3>
            <div class="contact-info">
                <div class="contact-item">
                    <strong>Phone:</strong> 01234 567 890
                </div>
                <div class="contact-item">
                    <strong>Email:</strong> info@unitydoors.com
                </div>
                <div class="contact-item">
                    <strong>Address:</strong><br>
                    Unity Doors Ltd<br>
                    Industrial Estate<br>
                    Craftsman Way<br>
                    Sheffield, S12 3AB
                </div>
                <div class="contact-item">
                    <strong>Opening Hours:</strong><br>
                    Mon-Fri: 8:00 AM - 6:00 PM<br>
                    Sat: 9:00 AM - 4:00 PM<br>
                    Sun: Closed
                </div>
            </div>
            <p><em>For quotes from this configurator, please export your configuration and email it to our sales team.</em></p>
        </div>
    `);document.body.appendChild(h)};function E(h,e){const t=document.createElement("div");return t.className="modal-overlay",t.innerHTML=`
        <div class="modal">
            <div class="modal-header">
                <h2>${h}</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                ${e}
            </div>
        </div>
    `,t.querySelector(".modal-close").addEventListener("click",()=>{document.body.removeChild(t)}),t.addEventListener("click",i=>{i.target===t&&document.body.removeChild(t)}),t}document.addEventListener("DOMContentLoaded",()=>{try{window.doorConfiguratorApp=new q,window.doorCatalog=w,console.log("DOM loaded - Door configurator app started")}catch(h){console.error("Failed to initialize Door Configurator:",h),alert("Failed to load Door Configurator. Please refresh the page.")}});window.addEventListener("error",h=>{console.error("Door configurator error:",h.error),console.log("An error occurred. Check console for details.")});window.addEventListener("unhandledrejection",h=>{console.error("Unhandled promise rejection:",h.reason)});
